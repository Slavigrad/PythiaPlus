<div class="dashboard-page">
  <!-- Dashboard Header -->
  <header class="dashboard-header">
    <div class="dashboard-header__content">
      <h1 class="dashboard-title">Talent Pool Intelligence</h1>
      <p class="dashboard-subtitle">Real-time insights into your talent pipeline</p>
    </div>
    <button
      class="refresh-button"
      (click)="refreshDashboard()"
      [disabled]="loading()"
      aria-label="Refresh dashboard data"
    >
      <mat-icon>refresh</mat-icon>
    </button>
  </header>

  @if (loading()) {
    <!-- Loading State -->
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Loading dashboard...</p>
    </div>
  } @else if (error()) {
    <!-- Error State -->
    <div class="error-container">
      <mat-icon>error_outline</mat-icon>
      <h2>Failed to load dashboard</h2>
      <p>{{ error() }}</p>
      <button (click)="refreshDashboard()">
        <mat-icon>refresh</mat-icon>
        Retry
      </button>
    </div>
  } @else if (summaryStats()) {
    <!-- Dashboard Content -->
    <div class="dashboard-content">
      <!-- Summary Cards -->
      <section class="summary-section" role="region" aria-label="Summary statistics">
        <div class="summary-grid">
          <app-summary-card
            title="Total Profiles"
            [value]="summaryStats()!.totalProfiles"
            subtitle="In talent pool"
            icon="groups"
            color="primary"
          />

          <app-summary-card
            title="Available Now"
            [value]="summaryStats()!.availableNow"
            subtitle="Ready to hire"
            icon="check_circle"
            color="success"
          />

          <app-summary-card
            title="On Notice"
            [value]="summaryStats()!.onNotice"
            subtitle="2-3 months"
            icon="schedule"
            color="warning"
          />

          <app-summary-card
            title="Cities Covered"
            [value]="summaryStats()!.citiesCovered"
            subtitle="Global reach"
            icon="public"
            color="accent"
          />
        </div>
      </section>

      <!-- Charts Grid -->
      <div class="charts-grid">
        <!-- Availability Donut Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>Availability Snapshot</mat-card-title>
            <mat-card-subtitle>Distribution by availability status</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            @defer (on viewport; prefetch on idle) {
              @if (availabilityChartData()) {
                <app-donut-chart
                  [data]="availabilityChartData()!"
                  centerText="Total"
                  (chartClick)="onAvailabilityClick($event)"
                />
              }
            } @placeholder {
              <div class="chart-placeholder" aria-label="Loading availability chart">
                <div class="chart-skeleton"></div>
              </div>
            } @loading (minimum 200ms) {
              <div class="chart-placeholder" aria-label="Loading availability chart">
                <div class="chart-skeleton pulse"></div>
              </div>
            }
          </mat-card-content>
        </mat-card>

        <!-- Locations Bar Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <div class="card-header-content">
              <div>
                <mat-card-title>Top Locations</mat-card-title>
                <mat-card-subtitle>Geographic distribution of talent</mat-card-subtitle>
              </div>
              <mat-button-toggle-group
                [value]="locationViewMode()"
                (change)="locationViewMode.set($event.value)"
                aria-label="Toggle between cities and countries view"
              >
                <mat-button-toggle value="cities">Cities</mat-button-toggle>
                <mat-button-toggle value="countries">Countries</mat-button-toggle>
              </mat-button-toggle-group>
            </div>
          </mat-card-header>
          <mat-card-content>
            @defer (on viewport; prefetch on idle) {
              @if (locationsChartData()) {
                <app-horizontal-bar-chart
                  [data]="locationsChartData()!"
                  [height]="350"
                  (chartClick)="onLocationClick($event)"
                />
              }
            } @placeholder {
              <div class="chart-placeholder" aria-label="Loading locations chart">
                <div class="chart-skeleton" style="height: 350px;"></div>
              </div>
            } @loading (minimum 200ms) {
              <div class="chart-placeholder" aria-label="Loading locations chart">
                <div class="chart-skeleton pulse" style="height: 350px;"></div>
              </div>
            }
          </mat-card-content>
        </mat-card>

        <!-- Skills Bar Chart -->
        <mat-card class="chart-card chart-card--full-width">
          <mat-card-header>
            <div class="card-header-content">
              <div>
                <mat-card-title>Top Skills in Talent Pool</mat-card-title>
                <mat-card-subtitle>Most common skills and technologies</mat-card-subtitle>
              </div>
              <mat-button-toggle-group
                [value]="skillViewMode()"
                (change)="skillViewMode.set($event.value)"
                aria-label="Toggle between skills and technologies view"
              >
                <mat-button-toggle value="skills">Skills</mat-button-toggle>
                <mat-button-toggle value="technologies">Technologies</mat-button-toggle>
              </mat-button-toggle-group>
            </div>
          </mat-card-header>
          <mat-card-content>
            @defer (on viewport; prefetch on idle) {
              @if (skillsChartData()) {
                <app-horizontal-bar-chart
                  [data]="skillsChartData()!"
                  [height]="450"
                  (chartClick)="onSkillClick($event)"
                />
              }
            } @placeholder {
              <div class="chart-placeholder" aria-label="Loading skills chart">
                <div class="chart-skeleton" style="height: 450px;"></div>
              </div>
            } @loading (minimum 200ms) {
              <div class="chart-placeholder" aria-label="Loading skills chart">
                <div class="chart-skeleton pulse" style="height: 450px;"></div>
              </div>
            }
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  }
</div>
