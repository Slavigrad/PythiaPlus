<!-- =============================================================================
     STEP 5: THE CREDENTIALS - EDUCATION & CERTIFICATIONS
     ============================================================================= -->
<div class="credentials-form">

  <!-- =============================================================================
       EDUCATION SECTION
       ============================================================================= -->
  <section class="section education-section">
    <div class="section-header">
      <div class="header-content">
        <mat-icon class="section-icon">school</mat-icon>
        <div>
          <h3 class="section-title">Education</h3>
          <p class="section-subtitle">Academic achievements and degrees</p>
        </div>
      </div>
      @if (!isAddingEducation() && educations().length > 0) {
        <button
          mat-mini-fab
          color="primary"
          class="add-fab"
          (click)="onAddEducation()"
          aria-label="Add education"
        >
          <mat-icon>add</mat-icon>
        </button>
      }
    </div>

    <!-- Education Timeline -->
    @if (educations().length > 0 && !isAddingEducation()) {
      <div class="education-timeline">
        @for (education of educations(); track $index) {
          <div class="timeline-item">
            <!-- Timeline connector -->
            <div class="timeline-connector">
              <div class="timeline-dot" [style.background]="getDegreeColor(education.degree)"></div>
              @if ($index < educations().length - 1) {
                <div class="timeline-line" [style.background]="'linear-gradient(180deg, ' + getDegreeColor(education.degree) + ' 0%, ' + getDegreeColor(educations()[$index + 1].degree) + ' 100%)'"></div>
              }
            </div>

            <!-- Education card -->
            <div class="education-card">
              <div class="card-header">
                <div class="degree-badge" [style.background]="getDegreeColor(education.degree)">
                  <mat-icon>{{ getDegreeIcon(education.degree) }}</mat-icon>
                </div>
                <div class="header-content">
                  <h4 class="institution-name">{{ education.institution }}</h4>
                  <p class="degree-title">{{ education.degree }}</p>
                  @if (education.fieldOfStudy) {
                    <p class="field-of-study">{{ education.fieldOfStudy }}</p>
                  }
                </div>
                <div class="card-actions">
                  <button
                    mat-icon-button
                    class="action-button"
                    (click)="onEditEducation($index)"
                    aria-label="Edit education"
                  >
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    class="action-button remove-button"
                    (click)="onRemoveEducation($index)"
                    aria-label="Remove education"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>

              <div class="card-body">
                <div class="date-range">
                  <mat-icon class="date-icon">calendar_today</mat-icon>
                  <span class="date-text">
                    {{ formatDateDisplay(education.startDate) }} â€“
                    @if (education.endDate) {
                      {{ formatDateDisplay(education.endDate) }}
                    } @else {
                      Present
                    }
                  </span>
                  <span class="duration">
                    ({{ calculateDuration(education.startDate, education.endDate) }})
                  </span>
                </div>

                @if (!education.endDate) {
                  <div class="current-badge">
                    <mat-icon>school</mat-icon>
                    <span>Currently Enrolled</span>
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Education Form -->
    @if (isAddingEducation()) {
      <form [formGroup]="educationForm" class="education-form" (ngSubmit)="onSaveEducation()">
        <div class="form-header">
          <h4 class="form-title">
            @if (isEditingEducation()) {
              Edit Education
            } @else {
              Add Education
            }
          </h4>
        </div>

        <!-- Institution -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Institution</mat-label>
          <input
            matInput
            formControlName="institution"
            placeholder="e.g., MIT, Stanford University"
            required
          />
          <mat-icon matPrefix>account_balance</mat-icon>
          @if (educationForm.controls.institution.invalid && educationForm.controls.institution.touched) {
            <mat-error>Institution is required</mat-error>
          }
        </mat-form-field>

        <!-- Degree -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Degree</mat-label>
          <input
            matInput
            formControlName="degree"
            placeholder="e.g., Bachelor of Science, Master of Engineering"
            required
          />
          <mat-icon matPrefix>workspace_premium</mat-icon>
          @if (educationForm.controls.degree.invalid && educationForm.controls.degree.touched) {
            <mat-error>Degree is required</mat-error>
          }
        </mat-form-field>

        <!-- Field of Study -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Field of Study</mat-label>
          <input
            matInput
            formControlName="fieldOfStudy"
            placeholder="e.g., Computer Science, Electrical Engineering"
          />
          <mat-icon matPrefix>menu_book</mat-icon>
        </mat-form-field>

        <!-- Date range -->
        <div class="date-row">
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Start Date</mat-label>
            <input
              matInput
              [matDatepicker]="eduStartPicker"
              formControlName="startDate"
              placeholder="MM/DD/YYYY"
              required
            />
            <mat-datepicker-toggle matSuffix [for]="eduStartPicker"></mat-datepicker-toggle>
            <mat-datepicker #eduStartPicker></mat-datepicker>
            @if (educationForm.controls.startDate.invalid && educationForm.controls.startDate.touched) {
              <mat-error>Start date is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="date-field">
            <mat-label>End Date</mat-label>
            <input
              matInput
              [matDatepicker]="eduEndPicker"
              formControlName="endDate"
              placeholder="MM/DD/YYYY"
            />
            <mat-datepicker-toggle matSuffix [for]="eduEndPicker"></mat-datepicker-toggle>
            <mat-datepicker #eduEndPicker></mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Currently enrolled checkbox -->
        <div class="current-checkbox">
          <mat-checkbox formControlName="isCurrent">
            I'm currently enrolled in this program
          </mat-checkbox>
        </div>

        <!-- Form actions -->
        <div class="form-actions">
          <button
            mat-button
            type="button"
            class="cancel-button"
            (click)="onCancelEducation()"
          >
            Cancel
          </button>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            class="save-button"
            [disabled]="educationForm.invalid"
          >
            <mat-icon>save</mat-icon>
            <span>Save Education</span>
          </button>
        </div>
      </form>
    }

    <!-- Empty state -->
    @if (educations().length === 0 && !isAddingEducation()) {
      <div class="empty-state">
        <mat-icon class="empty-icon">school</mat-icon>
        <h4 class="empty-title">No education added yet</h4>
        <p class="empty-text">Add academic achievements and degrees</p>
      </div>
    }

    <!-- Add button (when not adding) -->
    @if (!isAddingEducation() && educations().length === 0) {
      <div class="add-button-container">
        <button
          mat-raised-button
          color="primary"
          class="add-education-button"
          (click)="onAddEducation()"
        >
          <mat-icon>add</mat-icon>
          <span>Add Education</span>
        </button>
      </div>
    }
  </section>

  <!-- =============================================================================
       CERTIFICATIONS SECTION
       ============================================================================= -->
  <section class="section certifications-section">
    <div class="section-header">
      <div class="header-content">
        <mat-icon class="section-icon">verified</mat-icon>
        <div>
          <h3 class="section-title">Certifications</h3>
          <p class="section-subtitle">Professional credentials and licenses</p>
        </div>
      </div>
      @if (!isAddingCertification() && certifications().length > 0) {
        <button
          mat-mini-fab
          color="primary"
          class="add-fab"
          (click)="onAddCertification()"
          aria-label="Add certification"
        >
          <mat-icon>add</mat-icon>
        </button>
      }
    </div>

    <!-- Certifications Grid -->
    @if (certifications().length > 0 && !isAddingCertification()) {
      <div class="certifications-grid">
        @for (cert of certifications(); track $index) {
          <div class="certification-card"
               [class.expired]="isCertificationExpired(cert.expiryDate)"
               [class.expiring-soon]="isCertificationExpiringSoon(cert.expiryDate)">
            <div class="card-header">
              <div class="cert-badge">
                <mat-icon>verified</mat-icon>
              </div>
              <div class="card-actions">
                <button
                  mat-icon-button
                  class="action-button"
                  (click)="onEditCertification($index)"
                  aria-label="Edit certification"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  class="action-button remove-button"
                  (click)="onRemoveCertification($index)"
                  aria-label="Remove certification"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>

            <div class="card-body">
              <h4 class="cert-name">{{ cert.name }}</h4>
              <p class="cert-issuer">{{ cert.issuingOrganization }}</p>

              <div class="cert-dates">
                <div class="date-item">
                  <mat-icon>event</mat-icon>
                  <span>Issued: {{ formatDateDisplay(cert.issueDate) }}</span>
                </div>
                @if (cert.expiryDate) {
                  <div class="date-item">
                    <mat-icon>event_busy</mat-icon>
                    <span>Expires: {{ formatDateDisplay(cert.expiryDate) }}</span>
                  </div>
                }
              </div>

              @if (cert.credentialId) {
                <div class="credential-info">
                  <mat-icon>badge</mat-icon>
                  <span class="credential-id">{{ cert.credentialId }}</span>
                </div>
              }

              @if (cert.credentialUrl) {
                <a
                  [href]="cert.credentialUrl"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="verify-link"
                >
                  <mat-icon>open_in_new</mat-icon>
                  <span>Verify Credential</span>
                </a>
              }

              <!-- Status badges -->
              @if (isCertificationExpired(cert.expiryDate)) {
                <div class="status-badge expired">
                  <mat-icon>error</mat-icon>
                  <span>Expired</span>
                </div>
              } @else if (isCertificationExpiringSoon(cert.expiryDate)) {
                <div class="status-badge expiring-soon">
                  <mat-icon>warning</mat-icon>
                  <span>Expiring Soon</span>
                </div>
              } @else {
                <div class="status-badge active">
                  <mat-icon>check_circle</mat-icon>
                  <span>Active</span>
                </div>
              }
            </div>
          </div>
        }
      </div>
    }

    <!-- Certification Form -->
    @if (isAddingCertification()) {
      <form [formGroup]="certificationForm" class="certification-form" (ngSubmit)="onSaveCertification()">
        <div class="form-header">
          <h4 class="form-title">
            @if (isEditingCertification()) {
              Edit Certification
            } @else {
              Add Certification
            }
          </h4>
        </div>

        <!-- Certification Name -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Certification Name</mat-label>
          <input
            matInput
            formControlName="name"
            placeholder="e.g., AWS Certified Solutions Architect"
            required
          />
          <mat-icon matPrefix>verified</mat-icon>
          @if (certificationForm.controls.name.invalid && certificationForm.controls.name.touched) {
            <mat-error>Certification name is required</mat-error>
          }
        </mat-form-field>

        <!-- Issuing Organization -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Issuing Organization</mat-label>
          <input
            matInput
            formControlName="issuingOrganization"
            placeholder="e.g., Amazon Web Services (AWS)"
            required
          />
          <mat-icon matPrefix>business</mat-icon>
          @if (certificationForm.controls.issuingOrganization.invalid && certificationForm.controls.issuingOrganization.touched) {
            <mat-error>Issuing organization is required</mat-error>
          }
        </mat-form-field>

        <!-- Date range -->
        <div class="date-row">
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Issue Date</mat-label>
            <input
              matInput
              [matDatepicker]="certIssuePicker"
              formControlName="issueDate"
              placeholder="MM/DD/YYYY"
              required
            />
            <mat-datepicker-toggle matSuffix [for]="certIssuePicker"></mat-datepicker-toggle>
            <mat-datepicker #certIssuePicker></mat-datepicker>
            @if (certificationForm.controls.issueDate.invalid && certificationForm.controls.issueDate.touched) {
              <mat-error>Issue date is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Expiry Date</mat-label>
            <input
              matInput
              [matDatepicker]="certExpiryPicker"
              formControlName="expiryDate"
              placeholder="MM/DD/YYYY"
            />
            <mat-datepicker-toggle matSuffix [for]="certExpiryPicker"></mat-datepicker-toggle>
            <mat-datepicker #certExpiryPicker></mat-datepicker>
            <mat-hint>Leave empty if it doesn't expire</mat-hint>
          </mat-form-field>
        </div>

        <!-- Credential ID -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Credential ID</mat-label>
          <input
            matInput
            formControlName="credentialId"
            placeholder="e.g., ABC123456789"
          />
          <mat-icon matPrefix>badge</mat-icon>
        </mat-form-field>

        <!-- Credential URL -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Credential URL</mat-label>
          <input
            matInput
            formControlName="credentialUrl"
            type="url"
            placeholder="https://..."
          />
          <mat-icon matPrefix>link</mat-icon>
          <mat-hint>Link to verify the credential</mat-hint>
        </mat-form-field>

        <!-- Form actions -->
        <div class="form-actions">
          <button
            mat-button
            type="button"
            class="cancel-button"
            (click)="onCancelCertification()"
          >
            Cancel
          </button>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            class="save-button"
            [disabled]="certificationForm.invalid"
          >
            <mat-icon>save</mat-icon>
            <span>Save Certification</span>
          </button>
        </div>
      </form>
    }

    <!-- Empty state -->
    @if (certifications().length === 0 && !isAddingCertification()) {
      <div class="empty-state">
        <mat-icon class="empty-icon">verified</mat-icon>
        <h4 class="empty-title">No certifications added yet</h4>
        <p class="empty-text">Add professional credentials and licenses</p>
      </div>
    }

    <!-- Add button (when not adding) -->
    @if (!isAddingCertification() && certifications().length === 0) {
      <div class="add-button-container">
        <button
          mat-raised-button
          color="primary"
          class="add-certification-button"
          (click)="onAddCertification()"
        >
          <mat-icon>add</mat-icon>
          <span>Add Certification</span>
        </button>
      </div>
    }
  </section>

</div>
