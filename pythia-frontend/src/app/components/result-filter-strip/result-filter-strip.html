<div class="result-filter-strip">
  <!-- Header: Always Visible -->
  <div class="strip-header">
    <div class="header-left">
      <svg class="filter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
      </svg>
      <h3 class="header-title">Refine Results</h3>
      <span class="result-count">{{ resultMessage() }}</span>
      @if (activeFilterCount() > 0) {
        <span class="active-filter-badge" [attr.aria-label]="activeFilterCount() + ' filters active'">
          {{ activeFilterCount() }}
        </span>
      }
    </div>

    <div class="header-right">
      @if (hasInternalFilters()) {
        <button
          type="button"
          class="clear-all-btn"
          (click)="clearAllFilters()"
          matRipple
          aria-label="Clear all filters">
          <svg class="clear-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
          Clear All
        </button>
      }

      <button
        type="button"
        class="expand-btn"
        (click)="toggleExpanded()"
        [class.expanded]="isExpanded()"
        [attr.aria-expanded]="isExpanded()"
        [attr.aria-label]="isExpanded() ? 'Collapse filters' : 'Expand filters'"
        matRipple>
        <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Expandable Content -->
  @if (isExpanded()) {
    <div class="strip-content">
      <!-- Internal Search -->
      <div class="internal-search-section">
        <label for="internal-search" class="sr-only">Search within results</label>
        <div class="search-input-wrapper">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          <input
            id="internal-search"
            type="text"
            class="internal-search-input"
            placeholder="Search within results..."
            [(ngModel)]="internalSearchText"
            aria-label="Search within loaded results"
            autocomplete="off"
          />
          @if (internalSearchText()) {
            <button
              type="button"
              class="clear-search-btn"
              (click)="internalSearchText.set('')"
              matRipple
              aria-label="Clear search text">
              <svg class="clear-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          }
        </div>
      </div>

      <!-- Quick Filter Chips -->
      @if (hasChips()) {
        <div class="quick-filters-section">
          <!-- Technologies -->
          @if (technologyChips().length > 0) {
            <div class="chip-category">
              <h4 class="category-label">Technologies</h4>
              <div class="chip-list">
                @for (chip of technologyChips(); track chip.value) {
                  <button
                    type="button"
                    class="filter-chip"
                    [class.active]="chip.active"
                    [attr.data-category]="'technology'"
                    (click)="toggleTechnology(chip.value)"
                    [attr.aria-pressed]="chip.active"
                    [attr.aria-label]="chip.label + ' (' + chip.count + ' candidates)'"
                    matRipple>
                    <span class="chip-label">{{ chip.label }}</span>
                    <span class="chip-count">{{ chip.count }}</span>
                  </button>
                }
              </div>
            </div>
          }

          <!-- Skills -->
          @if (skillChips().length > 0) {
            <div class="chip-category">
              <h4 class="category-label">Skills</h4>
              <div class="chip-list">
                @for (chip of skillChips(); track chip.value) {
                  <button
                    type="button"
                    class="filter-chip"
                    [class.active]="chip.active"
                    [attr.data-category]="'skill'"
                    (click)="toggleSkill(chip.value)"
                    [attr.aria-pressed]="chip.active"
                    [attr.aria-label]="chip.label + ' (' + chip.count + ' candidates)'"
                    matRipple>
                    <span class="chip-label">{{ chip.label }}</span>
                    <span class="chip-count">{{ chip.count }}</span>
                  </button>
                }
              </div>
            </div>
          }

          <!-- Certifications -->
          @if (certificationChips().length > 0) {
            <div class="chip-category">
              <h4 class="category-label">Certifications</h4>
              <div class="chip-list">
                @for (chip of certificationChips(); track chip.value) {
                  <button
                    type="button"
                    class="filter-chip"
                    [class.active]="chip.active"
                    [attr.data-category]="'certification'"
                    (click)="toggleCertification(chip.value)"
                    [attr.aria-pressed]="chip.active"
                    [attr.aria-label]="chip.label + ' (' + chip.count + ' candidates)'"
                    matRipple>
                    <span class="chip-label">{{ chip.label }}</span>
                    <span class="chip-count">{{ chip.count }}</span>
                  </button>
                }
              </div>
            </div>
          }
        </div>
      }

      <!-- No chips message -->
      @if (!hasChips()) {
        <div class="no-chips-message">
          <p>No filter options available for current results.</p>
        </div>
      }
    </div>
  }

  <!-- Accessibility: Live region for filter changes -->
  <div
    role="status"
    aria-live="polite"
    aria-atomic="true"
    class="sr-only"
    id="filter-status">
    @if (hasInternalFilters()) {
      {{ filteredCount() }} of {{ totalResults() }} candidates match current filters
    }
  </div>
</div>
